<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The effects of connectivity • travelcost</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="The effects of connectivity">
<meta property="og:description" content="travelcost">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">travelcost</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/connectivity_effect.html">The effects of connectivity</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="connectivity_effect_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>The effects of connectivity</h1>
            
      
      
      <div class="hidden name"><code>connectivity_effect.Rmd</code></div>

    </div>

    
    
<p>The <code>travelcost</code> package uses graph-based algorithm to estimate travel costs and shortest paths. The region of interest is first divided in a grid of cells. Each cell is connected to its adjoining neighbours, with this connectivity represented in a graph structure. The cost of travel from every cell to each of its neighbours is calculated, and these costs are stored as the weights of the edges in the graph. Standard shortest-path algorithms can then be used to calculate the cost of travel from any cell to any other cell, with the total cost being the sum of the edge weights along the shortest path between those two cells.</p>
<p>The number of neighbours that each cell is connected to will affect the accuracy of the results. Consider a cell that is connected only to its four cardinal neighbours (i.e. the cells to its north, south, east, and west). I can only move along these connected edges. So in order to travel to the north-west, I must first move to the northern neighbour and then to its western neighbour (or west then north). Simple geometry tells us that this distance is longer than moving directly north-west. We can see this effect:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">travelcost</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">geosphere</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: sp</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_raster</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span>ext <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">99.75</span>, <span class="fl">140.25</span>, <span class="op">-</span><span class="fl">60.25</span>, <span class="op">-</span><span class="fl">19.75</span><span class="op">)</span><span class="op">)</span>,
                            res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"+proj=longlat"</span><span class="op">)</span>

<span class="va">from</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="op">-</span><span class="fl">20</span><span class="op">)</span>

<span class="co">## distances from this point to all cells in the raster, calculated as great-circle distances</span>
<span class="va">cost0</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/distanceFromPoints.html">distanceFromPoints</a></span><span class="op">(</span><span class="va">my_raster</span>, <span class="va">from</span><span class="op">)</span>

<span class="co">## construct a graph with only 4-neighbour connectivity</span>
<span class="va">g4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tc_build_graph.html">tc_build_graph</a></span><span class="op">(</span><span class="va">my_raster</span>, neighbours <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>

<span class="co">## set edge weights by great-circle distance</span>
<span class="va">g4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tc_set_edge_weights.html">tc_set_edge_weights</a></span><span class="op">(</span><span class="va">g4</span>, fun <span class="op">=</span> <span class="fu">geosphere</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/geosphere/man/distHaversine.html">distHaversine</a></span><span class="op">)</span>

<span class="co">## estimated distances from one cell to all others</span>
<span class="va">cost4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tc_cost.html">tc_cost</a></span><span class="op">(</span><span class="va">g4</span>, <span class="va">from</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="op">(</span><span class="va">cost4</span> <span class="op">-</span> <span class="va">cost0</span><span class="op">)</span> <span class="op">/</span> <span class="va">cost0</span> <span class="op">*</span> <span class="fl">100</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">hcl.colors</a></span><span class="op">(</span><span class="fl">51</span>, palette <span class="op">=</span> <span class="st">"BlueRed"</span><span class="op">)</span>,
     main <span class="op">=</span> <span class="st">"Error (%): 4 neighbours"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">from</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">from</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, col <span class="op">=</span> <span class="fl">1</span>, bg <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fl">21</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="connectivity_effect_files/figure-html/conn4-1.png" width="700"></p>
<p>Starting at the top-left cell, if we move directly south or east, then our estimated distance is exactly correct. However, if we move in a directly-diagonal line, our estimated distance is an overestimate by about 40%.</p>
<p>We can mitigate this effect by connecting each cell to all eight of its immediate neighbours, rather than just four:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tc_build_graph.html">tc_build_graph</a></span><span class="op">(</span><span class="va">my_raster</span>, neighbours <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>

<span class="co">## set edge weights by great-circle distance</span>
<span class="va">g8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tc_set_edge_weights.html">tc_set_edge_weights</a></span><span class="op">(</span><span class="va">g8</span>, fun <span class="op">=</span> <span class="fu">geosphere</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/geosphere/man/distHaversine.html">distHaversine</a></span><span class="op">)</span>

<span class="co">## estimated distances from one cell to all others</span>
<span class="va">cost8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tc_cost.html">tc_cost</a></span><span class="op">(</span><span class="va">g8</span>, <span class="va">from</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="op">(</span><span class="va">cost8</span> <span class="op">-</span> <span class="va">cost0</span><span class="op">)</span> <span class="op">/</span> <span class="va">cost0</span> <span class="op">*</span> <span class="fl">100</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">hcl.colors</a></span><span class="op">(</span><span class="fl">51</span>, palette <span class="op">=</span> <span class="st">"BlueRed"</span><span class="op">)</span>,
     main <span class="op">=</span> <span class="st">"Error (%): 8 neighbours"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">from</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">from</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, col <span class="op">=</span> <span class="fl">1</span>, bg <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fl">21</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="connectivity_effect_files/figure-html/conn8-1.png" width="700"></p>
<p>Now, our estimate when moving east, south, or south-east is exact. Moving at intermediate angles still introduces some error (up to a maximum of just over 8%). We can further reduce the error by introducing more neighbours - e.g. connecting each cell to its neighbours located to the south-south-east (i.e. two cells south and one cell east), south-south-west, east-east-south, and west-west-south:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g16</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tc_build_graph.html">tc_build_graph</a></span><span class="op">(</span><span class="va">my_raster</span>, neighbours <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>

<span class="co">## set edge weights by great-circle distance</span>
<span class="va">g16</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tc_set_edge_weights.html">tc_set_edge_weights</a></span><span class="op">(</span><span class="va">g16</span>, fun <span class="op">=</span> <span class="fu">geosphere</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/geosphere/man/distHaversine.html">distHaversine</a></span><span class="op">)</span>

<span class="co">## estimated distances from one cell to all others</span>
<span class="va">cost16</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tc_cost.html">tc_cost</a></span><span class="op">(</span><span class="va">g16</span>, <span class="va">from</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="op">(</span><span class="va">cost16</span> <span class="op">-</span> <span class="va">cost0</span><span class="op">)</span> <span class="op">/</span> <span class="va">cost0</span> <span class="op">*</span> <span class="fl">100</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">hcl.colors</a></span><span class="op">(</span><span class="fl">51</span>, palette <span class="op">=</span> <span class="st">"BlueRed"</span><span class="op">)</span>,
     main <span class="op">=</span> <span class="st">"Error (%): 16 neighbours"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">from</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">from</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, col <span class="op">=</span> <span class="fl">1</span>, bg <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fl">21</span>, cex <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="connectivity_effect_files/figure-html/conn16-1.png" width="700"></p>
<p>In principle we could continue adding more neighbours, but there is a point of diminishing returns. Typically when calculating travel cost we need to account for barriers (e.g. islands or other land features that prevent an animal from swimming in a direct path across those features) or varying cost of travel due to currents, wind, or topography. As we add more neighbours to each cell’s connectivity, the step distance associated with those edges becomes longer, and we are more likely to be stepping over barrier features or missing fine-scale structure in cost fields such as topography. The appropriate choice of connectivity therefore depends on the spatial scales of the grid and any cost fields or barrier features, and computational demands (more neighbours and/or a finer grid means a larger graph, and higher computational demands).</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ben Raymond.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
